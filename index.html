<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FSB_Shopify</title>
    <link rel="stylesheet" href="index.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato&family=Roboto&family=Josefin+Sans&family=Lobster&family=Open+Sans&family=Poiret+One&family=Dancing+Script&family=Bangers&family=Playfair+Display&family=Chewy&family=Quicksand&family=Great+Vibes&family=Righteous&family=Crafty+Girls&family=Mystery+Quest&family=Montserrat&family=Oswald&family=Unica+One&family=Mulish&family=Raleway&family=Carter+One&family=Varela+Round&family=Julius+Sans+One&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <main class="container">
      <!-- Setup Guidelines -->
      <div class="setup-guidelines">
        <section class="card">
          <h2>SetUp Guidelines</h2>
          <p>Once the app is installed, please follow the below steps</p>
          <ol>
            <li>
              Provide bar’s Required fields (Title, Goal amount, Initial &
              Progress messages, Currency)
            </li>
            <li>
              Provide Optional fields (Currency symbol position, link and Style
              configuration) if required.
            </li>
            <li>
              Look at the preview block to see bar's display in your store.
            </li>
            <li>
              Click on "Activate" Button, then the Bar will appear in your
              store.
            </li>
            <li>Submit the Bar details when required fields are filled.</li>
            <li>Once Bar is created, enable it in your store.</li>
            <li>
              If you want to edit the bar details, please edit and click the
              "Update" Button.
            </li>
          </ol>
        </section>

        <!-- Enable bar -->
        <section class="card">
          <h2>Enable bar in the Store</h2>
          <ol>
            <li>Go to Shopify Admin → Online Store → Customize.</li>
            <li>Go to the app embeds in the left sidebar.</li>
            <li>Enable the FSB button there.</li>
          </ol>
        </section>
      </div>

      <!-- Shipping Title -->
      <div class="shopping-bar-style-container">
        <section class="title-section">
          <p class="label">Shipping bar title</p>
          <button class="deactivate-btn">Deactivate</button>
        </section>

        <!-- Content Configuration -->
        <section class="card">
          <h2>Content Configuration</h2>
          <div class="form-group">
            <label>Title</label>
            <input
              class="shipping-bar-title"
              type="text"
              placeholder="shipping bar title"
            />
            <small>For your own internal reference - only you can see it</small>
          </div>

          <div class="row">
            <div class="form-group">
              <label>Free Shipping Goal</label>
              <input
                class="free-shipping-goal"
                type="number"
                placeholder="Enter your Free Shipping Goal"
              />
              <p class="error-amount-not-fill">FreeShippingGoal is required</p>
            </div>
            <div class="form-group">
              <label>Secondary Goal</label>
              <input type="text" placeholder="Add Secondary Goal" />
              <a href="#">Upgrade to Premium</a>
            </div>
          </div>

          <!-- message configuration -->
          <table class="content-table">
            <tbody>
              <tr>
                <td>Initial Message</td>
                <td>
                  <input
                    class="pre-initial-message"
                    type="text"
                    placeholder="pre cart message"
                  />
                  <b class="free-shipping-goal-amount">$</b>
                  <input
                    class="post-initial-message"
                    type="text"
                    placeholder="post cart message"
                  />
                  <p>Display when cart is empty</p>
                </td>
              </tr>
              <tr>
                <td>Progress Message</td>
                <td>
                  <input
                    class="pre-progress-message"
                    type="text"
                    placeholder="pre progress message"
                  />
                  <b class="free-progress-goal-amount">$180</b>
                  <input
                    class="post-progress-message"
                    type="text"
                    placeholder="post progress message"
                  />
                  <p>Display when cart Value is less than goal amount</p>
                </td>
              </tr>

              <tr>
                <td>Goal Achieved Message</td>
                <td>
                  <input
                    class="pre-goal-message"
                    type="text"
                    placeholder="enter achieved message"
                  />
                  <p>Display when cart Value is greater than goal</p>
                </td>
              </tr>
              <tr>
                <td>Currency</td>
                <td>
                  <input
                    class="currency"
                    type="text"
                    placeholder="Currency"
                    value="USD"
                  />
                </td>
              </tr>
              <tr>
                <td>Currency Symbol</td>
                <td>
                  <input
                    class="currency-symbol"
                    type="text"
                    placeholder="Currency Symbol"
                    value="$"
                  />
                </td>
              </tr>
              <tr>
                <td>Position of Currency Symbol</td>
                <td>
                  <select class="currency-symbol-position">
                    >
                    <option value="before-amount">
                      Position of Symbol before the Amount
                    </option>
                    <option value="after-amount">
                      Position of Symbol after the Amount
                    </option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>Add link to the bar</td>
                <td>
                  <p>The bar will be clickable after adding a link</p>
                  <select>
                    <option>ON</option>
                    <option>OFF</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>BackGround Image upload</td>
                <td>
                  <span>Upgrade to Premium</span>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Style Configuration -->
        <section class="card">
          <h2>Style Configuration</h2>
          <div class="row">
            <div class="form-group">
              <label>Background Color</label>
              <input
                class="background-color-appear"
                type="color"
                value="#cbfef6"
              />
            </div>
            <div class="form-group">
              <label>Text Color</label>
              <input class="text-color-appear" type="color" value="#010f01" />
            </div>
            <div class="form-group">
              <label>Special Text Color</label>
              <input
                class="special-text-color-appear"
                type="color"
                value="#f41150"
              />
            </div>
          </div>
        </section>

        <!-- Font Family -->
        <section class="card">
          <h2>Font Family</h2>
          <div class="font-list">
            <!-- Buttons will be populated here by JavaScript -->
          </div>
        </section>

        <!-- font size card -->
        <section class="card">
          <div class="form-group">
            <h2>Font Size</h2>
            <input
              class="font-size-appear"
              type="number"
              type="step"
              value="18"
            />
          </div>
        </section>

        <!-- Targeting Configuration -->
        <section class="card">
          <h2>Targeting Configuration</h2>
          <div class="target-group">
            <h2>Page Targeting</h2>
            <label><input type="radio" name="page" checked /> All Pages</label>
            <br />
            <label
              ><input type="radio" name="page" /> Homepage Only
              <a href="#">Upgrade to Premium</a></label
            >
            <br />
            <label
              ><input type="radio" name="page" /> Cartpage Only
              <a href="#">Upgrade to Premium</a></label
            >
            <br />
            <label
              ><input type="radio" name="page" /> Product Page
              <a href="#">Upgrade to Premium</a></label
            >
          </div>

          <div class="target-group">
            <h2>Customer Targeting</h2>
            <label><input type="radio" name="customer" /> All Customers </label>
            <br />
            <label
              ><input type="radio" name="customer" /> Based on subscription
              <a href="#">Upgrade to Premium</a></label
            >
            <br />
            <label
              ><input type="radio" name="customer" /> Based on customer tag
              <a href="#">Upgrade to Premium</a></label
            >
            <br />
            <label
              ><input type="radio" name="customer" /> Based on total spent
              <a href="#">Upgrade to Premium</a></label
            >
          </div>
        </section>

        <!-- preview message block -->
        <div class="preview-msg-block">
          <span>Preview Block</span>
          <div>
            <h2>Initial Message</h2>
            <input
              class="preview-msg"
              type="text"
              placeholder="You are $xx away from free shipping!"
            />
          </div>
          <div>
            <h2>In Progress Message</h2>
            <input
              class="preview-msg"
              type="text"
              placeholder="Congratulations! You have unlocked free shipping!"
            />
          </div>
          <div>
            <h2>Success Message</h2>
            <input
              class="preview-msg"
              type="text"
              placeholder="You have unlocked free shipping!"
            />
          </div>
        </div>

        <!-- update button to apply changes -->
        <button class="update-btn">Update</button>
      </div>
      <!-- contact us support -->
      <div class="contactUs-support">
        <div class="contactUs-support-inner">
          Feel free to <a href="">Contact Us</a>
        </div>
      </div>
    </main>
  </body>
  <script>
    let FreeShippingDiscount = {
      store_id: "shopify_store_123",
      freeShippingAmount: "",
      currency: "USD",
      currencySymbol: "$",
      ShippingTitle: "my title",
      updatedCurrencyPosition: "amount",
      currencySymbolPosition: "before amount",
      progressCartValue: 0,
      currentCartValue: 400,
      remainingAmount: 0,
      isFreeShippingAchieved: false,
      styleBar: {
        fontFamily: "Segoe UI",
        fontSize: "18px",
        backgroundColor: "#d3d3d3",
        textColor: "#000000",
        specialTextColor: "#FF0000",
      },
      messagesBar: {
        InitialMessageBar:
          "Get your shopping on! Add $100 more for free shipping.",
        ProgressMessageBar: "Add $X more to get free shipping!",
        GoalMessageBar: "🎉 You’ve unlocked free shipping!",
      },
      updatedAt: new Date().toISOString(),
    };

    // Populate font family buttons and capture font-family style
    document.addEventListener("DOMContentLoaded", function () {
      const fontFamilyType = {
        fonts: [
          "Lato",
          "Roboto",
          "Josefin Sans",
          "Lobster",
          "Open Sans",
          "Poiret One",
          "Dancing Script",
          "Bangers",
          "Playfair Display",
          "Chewy",
          "Quicksand",
          "Great Vibes",
          "Righteous",
          "Crafty Girls",
          "Mystery Quest",
          "Montserrat",
          "Oswald",
          "Unica One",
          "Mulish",
          "Raleway",
          "Carter One",
          "Varela Round",
          "Julius Sans One",
        ],
      };
      let previewMsgBlock = document.querySelectorAll(".preview-msg");
      const fontFamilyContainer =
        document.getElementsByClassName("font-list")[0];
      fontFamilyType.fonts.forEach((font) => {
        const btn = document.createElement("button");
        btn.innerText = font;
        btn.style.fontFamily = font;
        btn.addEventListener("click", () => {
          previewMsgBlock.forEach((input) => {
            input.style.fontFamily = font;
            FreeShippingDiscount.styleBar["fontFamily"] = font;
          });
        });
        fontFamilyContainer.appendChild(btn);
      });
    });

    // capture font size
    const fontSizeInput = document.querySelector(".font-size-appear");
    fontSizeInput.addEventListener("input", (event) => {
      const fontSize = event.target.value + "px";
      let previewMsgBlock = document.querySelectorAll(".preview-msg");
      previewMsgBlock.forEach((input) => {
        input.style.fontSize = fontSize;
        FreeShippingDiscount.styleBar["fontSize"] = fontSize;
      });
    });

    // background color capture
    const backgroundColorInput = document.querySelector(
      ".background-color-appear"
    );
    backgroundColorInput.addEventListener("input", (event) => {
      const backgroundColor = event.target.value;
      let previewMsgBlock = document.querySelectorAll(".preview-msg");
      previewMsgBlock.forEach((input) => {
        input.style.backgroundColor = backgroundColor;
        FreeShippingDiscount.styleBar["backgroundColor"] = backgroundColor;
      });
    });

    // text color capture
    const textColorInput = document.querySelector(".text-color-appear");
    textColorInput.addEventListener("input", (event) => {
      const textColor = event.target.value;
      let previewMsgBlock = document.querySelectorAll(".preview-msg");
      previewMsgBlock.forEach((input) => {
        input.style.color = textColor;
        FreeShippingDiscount.styleBar["textColor"] = textColor;
      });
    });

    // special text color capture
    const specialTextColorInput = document.querySelector(
      ".special-text-color-appear"
    );
    specialTextColorInput.addEventListener("input", (event) => {
      const specialTextColor = event.target.value;
      let previewMsgBlock = document.querySelectorAll(".preview-msg");
      previewMsgBlock.forEach((input) => {
        input.style.color = specialTextColor;
        FreeShippingDiscount.styleBar["specialTextColor"] = specialTextColor;
      });
    });

    // shipping bar title capture
    const shippingBarTitle = document.querySelector(".shipping-bar-title");
    shippingBarTitle.addEventListener("input", (event) => {
      const title = event.target.value;
      FreeShippingDiscount["ShippingTitle"] = title;
    });

    // currency capture
    let currencyInput = document.querySelector(".currency");
    currencyInput.addEventListener("input", (event) => {
      const currency = event.target.value;
      FreeShippingDiscount["currency"] = currency;
    });

    // ----------------------------------------
    // Grab the inputs once
    const freeShippingGoalInput = document.querySelector(".free-shipping-goal");
    const goalAmountTag = document.querySelector(".free-shipping-goal-amount");
    let progressAmountTag = document.querySelector(
      ".free-progress-goal-amount"
    );

    // Helper – set the *current* cart total (you will call this later when you have the real cart object)
    function setCartTotal(newTotal) {
      FreeShippingDiscount.currentCartValue = Number(newTotal) || 0;
      updateShippingStatus(); // recalc instantly
    }

    // Core calculation + logging + DOM update
    function updateShippingStatus() {
      const goalValue = Number(freeShippingGoalInput.value) || 0;
      const cartValue = Number(FreeShippingDiscount.currentCartValue) || 0;
      const remaining = goalValue - cartValue;
      FreeShippingDiscount.remainingAmount = Math.abs(remaining);
      FreeShippingDiscount.freeShippingAmount = goalValue;
      FreeShippingDiscount.remainingAmount = remaining;
      FreeShippingDiscount.isFreeShippingAchieved = remaining <= 0;

      goalAmountTag.textContent = `${FreeShippingDiscount.currencySymbol}${goalValue}`;

      if (remaining > 0) {
        progressAmountTag.textContent = `${FreeShippingDiscount.currencySymbol}${remaining}`;
      } else {
        progressAmountTag.textContent = "0";
      }
      // log outputs
      if (cartValue >= goalValue) {
        console.log("Free Shipping Achieved!");
      } else {
        console.log(
          `Free Shipping Not Achieved. Add ${FreeShippingDiscount.currencySymbol}${remaining} more to unlock free shipping.`
        );
      }

      console.log("Shipping Status:", {
        goalValue,
        cartValue,
        remaining,
        achieved: FreeShippingDiscount.isFreeShippingAchieved,
      });
    }

    // run once on page load first time
    updateShippingStatus();
    // recalc every time the user changes the goal
    freeShippingGoalInput.addEventListener("input", updateShippingStatus);

    // setCartTotal(realCartTotal);
    //  setCartTotal(shopifyCart.subtotal_price / 100);
    // setCartTotal(shopifyCart.subtotal_price);
    // ----------------------------------------

    // currency symbol capture
    let currencySymbolInput = document.querySelector(".currency-symbol");
    currencySymbolInput.addEventListener("input", (event) => {
      const currencySymbol = event.target.value;
      FreeShippingDiscount["currencySymbol"] = currencySymbol;

      // --- Update preview messages dynamically ---
      const amount = FreeShippingDiscount.freeShippingAmount || "XX";

      // Initial Message
      const preInitial = document.querySelector(".pre-initial-message").value;
      const postInitial = document.querySelector(".post-initial-message").value;
      const initialPreview = document.getElementsByClassName("preview-msg")[0];
      initialPreview.value = `${preInitial} ${currencySymbol}${amount} ${postInitial}`;
      FreeShippingDiscount.messagesBar["InitialMessageBar"] =
        initialPreview.value;

      // Progress Message
      const preProgress = document.querySelector(".pre-progress-message").value;
      const postProgress = document.querySelector(
        ".post-progress-message"
      ).value;
      const progressPreview = document.getElementsByClassName("preview-msg")[1];
      progressPreview.value = `${preProgress}${currencySymbol}${amount} ${postProgress}`;
      FreeShippingDiscount.messagesBar["ProgressMessageBar"] =
        progressPreview.value;

      // Goal Message
      const preGoal = document.querySelector(".pre-goal-message").value;
      const postGoal = document.querySelector(".post-goal-message").value;
      const goalPreview = document.getElementsByClassName("preview-msg")[2];
      goalPreview.value = `${preGoal}${currencySymbol}${amount} ${postGoal}`;
      FreeShippingDiscount.messagesBar["GoalMessageBar"] = goalPreview.value;
    });

    // currency symbol position capture
    let currencySymbolPositionInput = document.querySelector(
      ".currency-symbol-position"
    );

    currencySymbolPositionInput.addEventListener("input", (event) => {
      let currencySymbolPosition = event.target.value;
      if (currencySymbolPositionInput == "before-amount") {
        FreeShippingDiscount["updatedCurrencyPosition"] =
          FreeShippingDiscount.currencySymbol +
          FreeShippingDiscount.freeShippingAmount;
      } else {
        FreeShippingDiscount["updatedCurrencyPosition"] =
          FreeShippingDiscount.freeShippingAmount +
          FreeShippingDiscount.currencySymbol;
      }
    });

    // freeShippingGoal capture
    const freeShippingGoal = document.querySelector(".free-shipping-goal");
    freeShippingGoal.addEventListener("input", (event) => {
      const goalAmount = event.target.value;
      FreeShippingDiscount["freeShippingAmount"] = goalAmount;
    });

    // initial message (pre + post)
    const preInitialMessage = document.querySelector(".pre-initial-message");
    const postInitialMessage = document.querySelector(".post-initial-message");
    const InitialPreviewInput =
      document.getElementsByClassName("preview-msg")[0];
    let currencySymbolPreference = FreeShippingDiscount.currencySymbol;
    preInitialMessage.addEventListener("input", (event) => {
      preInitialMessage = event.target.value;
      const combinedMessage = `${preInitialMessage} ${currencySymbolPreference}${FreeShippingDiscount.freeShippingAmount} ${postInitialMessage.value}`;
      FreeShippingDiscount.messagesBar["InitialMessageBar"] = combinedMessage;
      InitialPreviewInput.value = combinedMessage;
    });

    postInitialMessage.addEventListener("input", (event) => {
      const postMessage = event.target.value;
      const combinedMessage = `${preInitialMessage.value} ${currencySymbolPreference}${FreeShippingDiscount.freeShippingAmount} ${postMessage}`;
      FreeShippingDiscount.messagesBar["InitialMessageBar"] = combinedMessage;
      InitialPreviewInput.value = combinedMessage;
    });

    // progress message (pre + post)
    const preProgressMessage = document.querySelector(".pre-progress-message");
    const postProgressMessage = document.querySelector(
      ".post-progress-message"
    );
    const ProgressPreviewInput =
      document.getElementsByClassName("preview-msg")[1];
    preProgressMessage.addEventListener("input", (event) => {
      preProgressMessage = event.target.value;
      const combinedMessage = `${preProgressMessage} ${currencySymbolPreference}${FreeShippingDiscount.remainingAmount} ${postProgressMessage.value}`;
      FreeShippingDiscount.messagesBar["ProgressMessageBar"] = combinedMessage;
      ProgressPreviewInput.value = combinedMessage;
    });
    postProgressMessage.addEventListener("input", (event) => {
      const postMessage = event.target.value;
      const combinedMessage = `${preProgressMessage.value} ${currencySymbolPreference}${FreeShippingDiscount.remainingAmount} ${postMessage}`;
      FreeShippingDiscount.messagesBar["ProgressMessageBar"] = combinedMessage;
      ProgressPreviewInput.value = combinedMessage;
    });

    // goal message (pre)
    const preGoalMessage = document.querySelector(".pre-goal-message");
    // const postGoalMessage = document.querySelector(".post-goal-message");

    const GoalPreviewInput = document.getElementsByClassName("preview-msg")[2];
    preGoalMessage.addEventListener("input", (event) => {
      const preMessage = event.target.value;
      const combinedMessage = `${preMessage}`;
      FreeShippingDiscount.messagesBar["GoalMessageBar"] = combinedMessage;
      GoalPreviewInput.value = combinedMessage;
      if (GoalPreviewInput.value === "") {
      }
    });

    let Base_Api = "https://free-shipping-discount-pz9g.vercel.app";
    async function fetchApi() {
      try {
        const data = await fetch(`${Base_Api}/get-fsb/shopify_store_001`);
        const res = await data.json();
        console.log(res);
      } catch (err) {
        console.log("Something went wrong", err);
      }
    }

    fetchApi();
    // log data on update button click
    const isErrorFreeShippingAmount = document.getElementsByClassName(
      "error-amount-not-fill"
    )[0];
    isErrorFreeShippingAmount.style.display = "none";
    const updateBtn = document.querySelector(".update-btn");
    updateBtn.addEventListener("click", () => {
      if (FreeShippingDiscount["freeShippingAmount"] === "") {
        isErrorFreeShippingAmount.style.display = "block";
        isErrorFreeShippingAmount.style.color = "red";
        return;
      } else {
        isErrorFreeShippingAmount.style.display = "none";
      }
      //   console.log(" Style_bar: ", FreeShippingDiscount.styleBar);
      console.log("FreeShippingDiscount:", FreeShippingDiscount);
      //   console.log(" Messages_bar: ", FreeShippingDiscount.messagesBar);
    });
  </script>
</html>
